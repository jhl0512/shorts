<!-- index.html -->
<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<link href="youtube_sample_globals.css" rel="stylesheet"/>
<link href="yotuube_sample.css" rel="stylesheet"/>
<style>
    /* 배경 비디오 깔기 위한 최소 설정 (UI는 전혀 변경되지 않음) */
    .video { position: relative; overflow: hidden; }
    .video video.video-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 0; pointer-events: none; }
    .video > * { position: relative; z-index: 1; }
    body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; }
    #container { height: 100vh; overflow-y: auto; scroll-snap-type: y mandatory; }
    #container::-webkit-scrollbar { display: none; }
    #loading { text-align: center; padding: 8px; background: #fff; color: #333; font-size: 0.9rem; }
  </style>
</head>
<body>
<div id="container">
<!-- 템플릿으로 사용할 한 개의 .video -->
<div class="video" id="video-template">
<div class="top">
<!-- search icon -->
<svg fill="none" height="25" viewbox="0 0 25 25" width="25" xmlns="http://www.w3.org/2000/svg">
<path d="M11.458 2.60449C16.3479 2.60449 20.3123 6.56815 20.3125 11.458C20.3125 13.5275 19.6008 15.43 18.4111 16.9375L22.0908 20.6172C22.4976 21.024 22.4976 21.684 22.0908 22.0908C21.684 22.4976 21.024 22.4976 20.6172 22.0908L16.9375 18.4111C15.43 19.6008 13.5274 20.3125 11.458 20.3125C6.56815 20.3123 2.60449 16.348 2.60449 11.458C2.60465 6.56826 6.56825 2.60466 11.458 2.60449ZM11.458 4.6875C7.71885 4.68767 4.68766 7.71885 4.6875 11.458C4.6875 15.1974 7.71875 18.2293 11.458 18.2295C15.1975 18.2295 18.2295 15.1975 18.2295 11.458C18.2293 7.71874 15.1974 4.6875 11.458 4.6875Z" fill="white"></path>
</svg>
<!-- more-vertical icon -->
<svg fill="none" height="25" viewbox="0 0 25 25" width="25" xmlns="http://www.w3.org/2000/svg">
<path d="M12.5 17.708C13.6506 17.708 14.583 18.6414 14.583 19.792C14.5828 20.9425 13.6505 21.875 12.5 21.875C11.3495 21.875 10.4172 20.9425 10.417 19.792C10.417 18.6414 11.3494 17.708 12.5 17.708ZM12.5 10.417C13.6506 10.417 14.583 11.3494 14.583 12.5C14.583 13.6506 13.6506 14.583 12.5 14.583C11.3494 14.583 10.417 13.6506 10.417 12.5C10.417 11.3494 11.3494 10.417 12.5 10.417ZM12.5 3.125C13.6505 3.12501 14.5828 4.05757 14.583 5.20801C14.583 6.3586 13.6506 7.29198 12.5 7.29199C11.3494 7.29199 10.417 6.35861 10.417 5.20801C10.4172 4.05757 11.3495 3.125 12.5 3.125Z" fill="white"></path>
</svg>
</div>
<div class="body">
<div class="left">
<div class="id">
<div class="ellipse"></div>
<div class="id-text"></div>
</div>
<p class="title-text"></p>
<div class="music">
<!-- music note icon -->
<svg fill="none" height="20" viewbox="0 0 19 20" width="19" xmlns="http://www.w3.org/2000/svg">
<path d="M14.25 13.167L14.2373 13.4092C14.1158 14.6069 13.1048 15.542 11.875 15.542C10.5634 15.542 9.50016 14.4786 9.5 13.167C9.5 11.8553 10.5633 10.792 11.875 10.792C12.4839 10.792 13.0377 11.0227 13.458 11.3994V6.1582L7.52051 9.8252V15.542L7.50879 15.7842C7.38733 16.982 6.37532 17.917 5.14551 17.917C3.83407 17.9168 2.77067 16.8535 2.77051 15.542C2.77051 14.2304 3.83397 13.1672 5.14551 13.167C5.75483 13.167 6.30905 13.3982 6.72949 13.7754V7.00879L14.25 2.36328V13.167ZM5.14551 13.958C4.2712 13.9582 3.5625 14.6676 3.5625 15.542C3.56266 16.4162 4.2713 17.1248 5.14551 17.125C6.01986 17.125 6.72933 16.4163 6.72949 15.542C6.72949 14.6675 6.01996 13.958 5.14551 13.958ZM11.875 11.583C11.0005 11.583 10.292 12.2925 10.292 13.167C10.2922 14.0413 11.0006 14.75 11.875 14.75C12.7494 14.75 13.4578 14.0413 13.458 13.167C13.458 12.2925 12.7495 11.583 11.875 11.583ZM7.52051 7.4502V8.89453L13.458 5.22754V3.78223L7.52051 7.4502Z" fill="white"></path>
</svg>
<div class="music-text"></div>
<div class="rectangle-1"></div>
</div>
</div>
<div class="right">
<button class="button"><svg fill="none" height="25" viewbox="0 0 26 25" width="26" xmlns="http://www.w3.org/2000/svg"><path d="M6.22949 22.396H4.14551C3.28278 22.3959 2.58313 21.6963 2.58301 20.8335V11.4585C2.58301 10.5957 3.28271 9.89618 4.14551 9.89602H6.22949V22.396ZM12.3857 2.605C12.5693 2.33447 12.9543 2.29766 13.1855 2.52883L14.0244 3.3677C14.8371 4.18055 15.1379 5.37416 14.8076 6.47512L13.9375 9.37453H20.8125C22.2506 9.37453 23.4169 10.5408 23.417 11.979C23.417 12.9578 22.8755 13.8086 22.0771 14.2534C22.5802 14.7282 22.8955 15.3997 22.8955 16.146C22.8954 17.4058 22.001 18.4555 20.8125 18.6968V21.354C20.8125 21.9293 20.3458 22.396 19.7705 22.396H8.83301C8.25787 22.3958 7.79199 21.9292 7.79199 21.354V10.0152C7.79199 9.59804 7.91716 9.1904 8.15137 8.84524L12.3857 2.605Z" fill="white"></path></svg><div class="text-wrapper">LIKE</div></button>
<button class="button"><svg fill="none" height="25" viewbox="0 0 26 25" width="26" xmlns="http://www.w3.org/2000/svg"><path d="M17.167 2.60449C17.742 2.60465 18.2078 3.07047 18.208 3.64551V14.9854C18.2079 15.4022 18.0827 15.8093 17.8486 16.1543L13.6143 22.3955C13.4306 22.666 13.0456 22.7028 12.8145 22.4717L11.9766 21.6328C11.1637 20.8199 10.8621 19.6255 11.1924 18.5244L12.0625 15.625H5.1875C3.74926 15.625 2.58301 14.4587 2.58301 13.0205C2.58315 12.0419 3.1237 11.19 3.92188 10.7451C3.41961 10.2705 3.10458 9.60009 3.10449 8.85449C3.10449 7.5946 3.99881 6.54303 5.1875 6.30176V3.64551C5.18768 3.07037 5.65431 2.60449 6.22949 2.60449H17.167ZM21.8545 2.60449C22.7173 2.60464 23.417 3.30414 23.417 4.16699V13.542C23.4168 14.4047 22.7172 15.1043 21.8545 15.1045H19.7705V2.60449H21.8545Z" fill="white"></path></svg><div class="text-wrapper">싫어요</div></button>
<button class="button"><svg fill="none" height="25" viewbox="0 0 26 25" width="26" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_10_42)">
<path clip-rule="evenodd" d="M3.27778 0C1.74365 0 0.5 1.24775 0.5 2.78694V17.4184C0.5 18.9575 1.74365 20.2053 3.27778 20.2053H19.25L23.7218 24.6918C24.378 25.3502 25.5 24.8839 25.5 23.9528V17.4184V2.78694C25.5 1.24775 24.2563 0 22.7222 0H3.27778ZM5.36111 6.96734C5.36111 6.19775 5.98294 5.57387 6.75 5.57387H19.25C20.0171 5.57387 20.6389 6.19775 20.6389 6.96734C20.6389 7.73693 20.0171 8.36081 19.25 8.36081H6.75C5.98294 8.36081 5.36111 7.73693 5.36111 6.96734ZM6.75 11.8445C5.98294 11.8445 5.36111 12.4684 5.36111 13.238C5.36111 14.0075 5.98294 14.6314 6.75 14.6314H15.0833C15.8504 14.6314 16.4722 14.0075 16.4722 13.238C16.4722 12.4684 15.8504 11.8445 15.0833 11.8445H6.75Z" fill="white" fill-rule="evenodd"></path>
</g>
<defs>
<clippath id="clip0_10_42">
<rect fill="white" height="25" width="26"></rect>
</clippath>
</defs>
</svg>
<div class="text-wrapper">999</div></button>
<button class="button"><svg fill="none" height="25" viewbox="0 0 26 25" width="26" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_10_35)">
<path clip-rule="evenodd" d="M25.0449 13.6714C25.6517 13.0534 25.6517 11.9466 25.0449 11.3286L14.1083 0.190604C13.6816 -0.243953 13.0181 0.112488 13.0181 0.776286V6.30158C6.10456 6.30158 0.5 12.8923 0.5 21.0225C0.5 22.183 0.614202 23.3122 0.830112 24.3953C0.955701 25.0253 1.65507 25.132 1.99521 24.6233C4.4078 21.0153 8.15343 18.6981 12.3593 18.6981C12.5802 18.6981 12.7999 18.7045 13.0181 18.7171V24.2237C13.0181 24.8875 13.6816 25.244 14.1083 24.8094L25.0449 13.6714Z" fill="white" fill-rule="evenodd"></path>
</g>
<defs>
<clippath id="clip0_10_35">
<rect fill="white" height="25" width="26"></rect>
</clippath>
</defs>
</svg>
<div class="text-wrapper">관심없음</div></button>
<div class="rectangle"></div>
</div>
</div>
</div>
<div id="loading">로딩 중...</div>

</div>
<script>
  const categories = ['rumbling'];
  const container = document.getElementById('container');
  const loading = document.getElementById('loading');
  const template = document.getElementById('video-template');
  template.removeAttribute('id'); container.removeChild(template);

  function parseCSV(text) {
    const lines = text.trim().split('\n');
    const headers = lines[0].split(',').map(h => h.trim());
    return lines.slice(1).map(line => {
      const cols = line.split(',').map(c => c.trim());
      let o = {};
      headers.forEach((h, i) => o[h] = cols[i] || '');
      return o;
    });
  }

  function createPost(data) {
    const post = template.cloneNode(true);
    const bg = document.createElement('video');
    bg.className = 'video-bg';
    bg.src = data['MP4 URL'];
    bg.autoplay = true;
    bg.loop = true;
    bg.playsInline = true;
    bg.muted = true;
    post.prepend(bg);

    post.querySelector('.id-text').textContent = data['ID'];
    post.querySelector('.title-text').textContent = data['TITLE'];
    post.querySelector('.music-text').textContent = data['MUSIC'];
    const cc = post.querySelector('.comment-count');
    if (cc) cc.textContent = data['COMMENT'] || '';
    return post;
  }

  
async function loadAll() {
  for (const cat of categories) {
    try {
      const res = await fetch(`${cat}.js`);
      if (!res.ok) throw new Error(`${cat}.js 로드 실패`);
      const data = await res.json();
      data.forEach(row => container.appendChild(createPost(row)));
      updateAudio();
    } catch (err) {
      console.error(err);
    }
  }
  loading.style.display = 'none';
}


  let isScrolling = false;
  container.addEventListener('wheel', e => {
    if (isScrolling) return;
    isScrolling = true;

    const direction = e.deltaY > 0 ? 1 : -1;
    const videos = [...container.querySelectorAll('.video')];
    const currentScroll = container.scrollTop;
    const viewHeight = container.clientHeight;

    let currentIndex = videos.findIndex(v => Math.abs(v.offsetTop - currentScroll) < viewHeight / 2);
    let targetIndex = currentIndex + direction;

    if (targetIndex >= 0 && targetIndex < videos.length) {
      container.scrollTo({ top: videos[targetIndex].offsetTop, behavior: 'smooth' });
    }

    setTimeout(() => {
      isScrolling = false;
      updateAudio();
    }, 600);
  });

  function updateAudio() {
    const videos = document.querySelectorAll('.video');
    const containerRect = container.getBoundingClientRect();
    videos.forEach(video => {
      const rect = video.getBoundingClientRect();
      const videoEl = video.querySelector('video');
      const fullyVisible = rect.top >= containerRect.top && rect.bottom <= containerRect.bottom;
      if (videoEl) {
        videoEl.muted = !fullyVisible;
        if (fullyVisible) videoEl.play();
        else videoEl.pause();
      }
    });
  }

  container.addEventListener('scroll', () => {
    clearTimeout(container._scrollTimeout);
    container._scrollTimeout = setTimeout(updateAudio, 200);
  });

  
container.addEventListener('wheel', (e) => {
  e.preventDefault();  // 기본 스크롤 막기
  if (isScrolling) return;
  isScrolling = true;

  const direction = e.deltaY > 0 ? 1 : -1;
  const videos = [...container.querySelectorAll('.video')];
  const currentScroll = container.scrollTop;
  const viewHeight = container.clientHeight;

  let currentIndex = videos.findIndex(v => Math.abs(v.offsetTop - currentScroll) < viewHeight / 2);
  if (currentIndex === -1) {
    currentIndex = Math.round(currentScroll / viewHeight);
  }

  let targetIndex = currentIndex + direction;
  targetIndex = Math.max(0, Math.min(videos.length - 1, targetIndex));

  const targetOffset = videos[targetIndex].offsetTop;
  container.scrollTo({ top: targetOffset, behavior: 'smooth' });

  setTimeout(() => {
    isScrolling = false;
    updateAudio();
  }, 600);
}, { passive: false });


loadAll();
</script>
</body>
</html>
